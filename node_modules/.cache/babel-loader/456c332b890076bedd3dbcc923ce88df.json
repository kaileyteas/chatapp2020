{"ast":null,"code":"import _objectSpread from \"/Users/kale/Desktop/school/HCDE 438/ChatApp/chatapp/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/Users/kale/Desktop/school/HCDE 438/ChatApp/chatapp/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useState, useEffect } from 'react';\nimport * as firebase from \"firebase/app\";\nimport \"firebase/firestore\";\nimport \"firebase/storage\";\nlet store;\nconst coll = 'messages';\n\nfunction useDB(room) {\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        messages = _useState2[0],\n        setMessages = _useState2[1];\n\n  function add(m) {\n    setMessages(current => {\n      const msgs = [m, ...current];\n      msgs.sort((a, b) => b.ts.seconds - a.ts.seconds);\n      return msgs;\n    });\n  }\n\n  function remove(id) {\n    setMessages(current => current.filter(m => m.id !== id));\n  }\n\n  useEffect(() => {\n    store.collection(coll).where('room', '==', room).onSnapshot(snap => snap.docChanges().forEach(c => {\n      const doc = c.doc,\n            type = c.type;\n      if (type === 'added') add(_objectSpread({}, doc.data(), {\n        id: doc.id\n      }));\n      if (type === 'removed') remove(doc.id);\n    }));\n  }, []);\n  return messages;\n}\n\nconst db = {};\n\ndb.send = function (msg) {\n  return store.collection(coll).add(msg);\n};\n\ndb.delete = function (id) {\n  return store.collection(coll).doc(id).delete();\n};\n\nexport { db, useDB };\nconst firebaseConfig = {\n  apiKey: \"AIzaSyC37_Lo0EODqLfGtxg7v1FDHbgHUSBa0no\",\n  authDomain: \"chatroom-e34eb.firebaseapp.com\",\n  databaseURL: \"https://chatroom-e34eb.firebaseio.com\",\n  projectId: \"chatroom-e34eb\",\n  storageBucket: \"chatroom-e34eb.appspot.com\",\n  messagingSenderId: \"86918280767\",\n  appId: \"1:86918280767:web:8cd5ba999c6a251e76aa8a\"\n};\nfirebase.initializeApp(firebaseConfig);\nstore = firebase.firestore();","map":{"version":3,"sources":["/Users/kale/Desktop/school/HCDE 438/ChatApp/chatapp/src/db.js"],"names":["useState","useEffect","firebase","store","coll","useDB","room","messages","setMessages","add","m","current","msgs","sort","a","b","ts","seconds","remove","id","filter","collection","where","onSnapshot","snap","docChanges","forEach","c","doc","type","data","db","send","msg","delete","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","initializeApp","firestore"],"mappings":";;AAAA,SAAQA,QAAR,EAAkBC,SAAlB,QAAkC,OAAlC;AACA,OAAO,KAAKC,QAAZ,MAA0B,cAA1B;AACA,OAAO,oBAAP;AACA,OAAO,kBAAP;AAEA,IAAIC,KAAJ;AACA,MAAMC,IAAI,GAAG,UAAb;;AAEA,SAASC,KAAT,CAAeC,IAAf,EAAqB;AAAA,oBACeN,QAAQ,CAAC,EAAD,CADvB;AAAA;AAAA,QACVO,QADU;AAAA,QACAC,WADA;;AAEjB,WAASC,GAAT,CAAaC,CAAb,EAAgB;AACZF,IAAAA,WAAW,CAACG,OAAO,IAAI;AACnB,YAAMC,IAAI,GAAG,CAACF,CAAD,EAAI,GAAGC,OAAP,CAAb;AACAC,MAAAA,IAAI,CAACC,IAAL,CAAU,CAACC,CAAD,EAAGC,CAAH,KAAQA,CAAC,CAACC,EAAF,CAAKC,OAAL,GAAeH,CAAC,CAACE,EAAF,CAAKC,OAAtC;AACA,aAAOL,IAAP;AACH,KAJU,CAAX;AAKH;;AACD,WAASM,MAAT,CAAgBC,EAAhB,EAAoB;AAChBX,IAAAA,WAAW,CAACG,OAAO,IAAGA,OAAO,CAACS,MAAR,CAAeV,CAAC,IAAGA,CAAC,CAACS,EAAF,KAAOA,EAA1B,CAAX,CAAX;AACH;;AAEDlB,EAAAA,SAAS,CAAC,MAAM;AACZE,IAAAA,KAAK,CAACkB,UAAN,CAAiBjB,IAAjB,EACCkB,KADD,CACO,MADP,EACc,IADd,EACmBhB,IADnB,EAECiB,UAFD,CAEYC,IAAI,IAAGA,IAAI,CAACC,UAAL,GAAkBC,OAAlB,CAA0BC,CAAC,IAAG;AAAA,YACtCC,GADsC,GACzBD,CADyB,CACtCC,GADsC;AAAA,YACjCC,IADiC,GACzBF,CADyB,CACjCE,IADiC;AAE7C,UAAIA,IAAI,KAAG,OAAX,EAAoBpB,GAAG,mBAAKmB,GAAG,CAACE,IAAJ,EAAL;AAAgBX,QAAAA,EAAE,EAACS,GAAG,CAACT;AAAvB,SAAH;AACpB,UAAIU,IAAI,KAAG,SAAX,EAAsBX,MAAM,CAACU,GAAG,CAACT,EAAL,CAAN;AACzB,KAJkB,CAFnB;AAOH,GARQ,EAQN,EARM,CAAT;AASA,SAAOZ,QAAP;AACH;;AAED,MAAMwB,EAAE,GAAG,EAAX;;AACAA,EAAE,CAACC,IAAH,GAAU,UAASC,GAAT,EAAc;AACpB,SAAO9B,KAAK,CAACkB,UAAN,CAAiBjB,IAAjB,EAAuBK,GAAvB,CAA2BwB,GAA3B,CAAP;AACH,CAFD;;AAGAF,EAAE,CAACG,MAAH,GAAY,UAASf,EAAT,EAAa;AACrB,SAAOhB,KAAK,CAACkB,UAAN,CAAiBjB,IAAjB,EAAuBwB,GAAvB,CAA2BT,EAA3B,EAA+Be,MAA/B,EAAP;AACH,CAFD;;AAIA,SAASH,EAAT,EAAa1B,KAAb;AAEA,MAAM8B,cAAc,GAAG;AACnBC,EAAAA,MAAM,EAAE,yCADW;AAEnBC,EAAAA,UAAU,EAAE,gCAFO;AAGnBC,EAAAA,WAAW,EAAE,uCAHM;AAInBC,EAAAA,SAAS,EAAE,gBAJQ;AAKnBC,EAAAA,aAAa,EAAE,4BALI;AAMnBC,EAAAA,iBAAiB,EAAE,aANA;AAOnBC,EAAAA,KAAK,EAAE;AAPY,CAAvB;AAUAxC,QAAQ,CAACyC,aAAT,CAAuBR,cAAvB;AACAhC,KAAK,GAAGD,QAAQ,CAAC0C,SAAT,EAAR","sourcesContent":["import {useState, useEffect} from 'react'\nimport * as firebase from \"firebase/app\"\nimport \"firebase/firestore\"\nimport \"firebase/storage\"\n\nlet store\nconst coll = 'messages'\n\nfunction useDB(room) {\n    const [messages, setMessages] = useState([])\n    function add(m) {\n        setMessages(current => {\n            const msgs = [m, ...current]\n            msgs.sort((a,b)=> b.ts.seconds - a.ts.seconds)\n            return msgs\n        })\n    }\n    function remove(id) {\n        setMessages(current=> current.filter(m=> m.id!==id))\n    }\n\n    useEffect(() => {\n        store.collection(coll)\n        .where('room','==',room)\n        .onSnapshot(snap=> snap.docChanges().forEach(c=> {\n            const {doc, type} = c\n            if (type==='added') add({...doc.data(),id:doc.id})\n            if (type==='removed') remove(doc.id)\n        }))\n    }, [])\n    return messages\n}\n\nconst db = {}\ndb.send = function(msg) {\n    return store.collection(coll).add(msg)\n}\ndb.delete = function(id) {\n    return store.collection(coll).doc(id).delete()\n}\n\nexport { db, useDB }\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyC37_Lo0EODqLfGtxg7v1FDHbgHUSBa0no\",\n    authDomain: \"chatroom-e34eb.firebaseapp.com\",\n    databaseURL: \"https://chatroom-e34eb.firebaseio.com\",\n    projectId: \"chatroom-e34eb\",\n    storageBucket: \"chatroom-e34eb.appspot.com\",\n    messagingSenderId: \"86918280767\",\n    appId: \"1:86918280767:web:8cd5ba999c6a251e76aa8a\"\n  };\n\nfirebase.initializeApp(firebaseConfig)\nstore = firebase.firestore()"]},"metadata":{},"sourceType":"module"}